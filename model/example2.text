import openai

openai.api_key = "YOUR_OPENAI_API_KEY"

def generate_report(
    query: str,
    retrieved_context: str = "",
    model: str = "gpt-3.5-turbo-16k",
    temperature: float = 0.7,
    top_p: float = 1.0,
    n: int = 1,
    max_tokens: int = 16000,
    frequency_penalty: float = 0.0,
    presence_penalty: float = 0.0
) -> str:
    system_prompt = (
        "You are a financial analyst assistant. Based on the user's query and context, generate a detailed financial report. "
        "Include data breakdowns, summaries, and mention charts if asked. If graph types are specified (e.g., pie, bar, line), describe them clearly."
    )

    messages = [
        {"role": "system", "content": system_prompt},
        {"role": "user", "content": f"Query: {query}\n\nContext: {retrieved_context}"}
    ]

    response = openai.ChatCompletion.create(
        model=model,
        messages=messages,
        temperature=temperature,
        top_p=top_p,
        n=n,
        max_tokens=max_tokens,
        frequency_penalty=frequency_penalty,
        presence_penalty=presence_penalty
    )

    return response.choices[0].message["content"]

